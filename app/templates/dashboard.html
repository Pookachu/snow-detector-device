<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .logout-btn { float: right; text-decoration: none; background: #d9534f; color: white; padding: 8px 15px; border-radius: 3px;}
        .controls button { font-size: 16px; padding: 10px 20px; margin-top: 20px; cursor: pointer; }
        #status-message { margin-top: 15px; font-style: italic; color: #555; }
    </style>
</head>
<body>
    <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
    <h1>Welcome, {{ username }}!</h1>
    <p>This is the protected device dashboard.</p>

    <div class="controls">
        <button id="take-picture-btn">Take Picture Now</button>
        <div id="status-message"></div>
    </div>

    <script>
        // Get references to the button and status message elements
        const takePictureBtn = document.getElementById('take-picture-btn');
        const statusMessage = document.getElementById('status-message');

        // Add a click event listener to the button
        takePictureBtn.addEventListener('click', () => {
            statusMessage.textContent = 'Requesting picture...';

            // Use the Fetch API to send a POST request to our new backend endpoint
            fetch('/take-picture', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json()) // Parse the JSON response from the server
            .then(data => {
                // Update the status message with the response from the server
                console.log('Success:', data);
                statusMessage.textContent = data.message;
            })
            .catch((error) => {
                // Handle any errors
                console.error('Error:', error);
                statusMessage.textContent = 'Error: Could not complete request.';
            });
        });
    </script>
</body>
</html>